---
title: "Аналітика в агро. Підрахунок збитків"
categories:
  - Work
tags:
  - work
  - agro
  - analytics
---

![alt text](https://miro.medium.com/max/1400/1*1kZ96T5XjZVqE3khhNqZyw.jpeg?raw=true)



В Україні в великих масштабах вирощується кукурудза та інші культури. Кожного року майбутній урожай сильно страждає від примх погоди. Град, дощ, вітер наносить непоправної шкоди полям. Цього неможливо уникнути, але аналітики в змозі підрахувати суми збитків до збору врожаю. Вивчивши мультиспектральні знімки, зроблені до і після граду. Застосовуючи індекс рослинності до обох зображень, можна обчислити різницю і отримати середню втрату рослинності в кожному полі.
Для проведення аналізу ми отримали два знімка PlanetScope. Planet Scope — це угруповання з 120 супутників, яка дозволяє щодня отримувати нові зображення для будь-якої заданої області на Землі.

![alt text](https://miro.medium.com/max/772/0*k2s7_9irYKlBjjQS.png?raw=true)

[Знимки для самостійного аналізу можна завантажити тут](https://www.kaggle.com/sergiishchus/corn-field-damage-planet).

Вивчення значень червоного та ближнього інфрачервоного каналів
Для поліпшення візуалізації змін врожаю ми використовуємо червоний і ближній інфрачервоний (NIR) канали, які застосовуються при оцінці здоров’я рослинності.
Хлорофіл в здорової рослинності поглинає більшу частину світу в червоному каналі для використання у фотосинтезі, тому відображає його дуже мало.
Структура осередків зі здоровою рослинністю сильно відбиває світло ближнього інфрачервоного діапазону.
Оскільки сенсор супутника фіксує кількість відбитого світла в різних каналах, значення пікселя знімка які показують здорову рослинність, зазвичай будуть низькими для червоного каналу і високими для NIR. Це показано на графіку спектрального профілю нижче. Навпаки, пригноблена або вмираюча рослинність буде поглинати менше червоного світла (отже, відображаючи його більше) і буде відображати менше світла NIR. На графіку також показано, що пікселі, що представляють голу землю будуть відображати ще більше світла в червоному каналі і менше в NIR.

![alt text](https://miro.medium.com/max/1200/0*1yvgymTh0IQAatag.png?raw=true)

Щоб краще зрозуміти мінливість значень відображення в червоному і ближньому інфрачервоному діапазонах на знімках Альберти, ми переглядамо статистику по зображенню, що надає інформацію про спектральному профілі на рівні пікселів.
Нижче графік спектрального профілю для окремого пікселя в зоні з здоровою, густою рослинністю. Значення відображення в червоному каналі (позначене червоним кольором) дуже низьке, а значення відображення в NIR (позначені сірим) — високе.

![alt text](https://miro.medium.com/max/834/0*gCpEV3ZXT97wIJmJ.png?raw=true)

Навпаки, у області, яка відноситься до голої землі і відсутності рослинності значення відображення в червоному каналі порівняно вище, а значення відображення в NIR — нижче.

![alt text](https://miro.medium.com/max/838/0*j5sxCTPMMxgcv95t.png?raw=true)

Обчислення різниці між значеннями Червоного і NIR може бути хорошим методом для вимірювання кількості здорової рослинності, яка присутня на земній поверхні. Ми виконуємо це, застосувавши до знімків індекс SAVI.

## Застосування індексу SAVI

Спектральний індекс об’єднує різні спектральні канали за допомогою математичної формули, зазвичай обчислюючи певний тип відносин. Підсумковими вихідними даними є нове растрове зображення.
Існує безліч різних індексів, що поєднують різні спектральні канали та використовують різні математичні формули. Кожен індекс служить для виділення різних явищ, наприклад, здоров’я рослинності, водних поверхонь, міського розвитку, наявності залізистих матеріалів в грунті і багато чого іншого.
Для виділення здорової рослинності є кілька індексів на вибір. Ми використовуємо індекс вегетації з корекцією по грунту (Soil-Adjusted Vegetation Index (SAVI)), який покладається на Червоний і Близький інфрачервоний канали та використовує наступну формулу відносин:
SAVI = ((NIR — Red) / (NIR + Red + L)) * (1 + L)
Що особливо важливо, SAVI вимірює розрив між Близьким ІК і Червоним каналами (NIR — Red). Високе значення SAVI вказує на підвищену наявність здорової рослинності.
SAVI покращено порівняно більш класичним NDVI , який використовує спрощену формулу без коефіцієнта L. Коефіцієнт L додається в формулу, щоб мінімізувати вплив відхилень яскравості грунту в вихідних значеннях. L зазвичай присвоюється значення 0.5 для сцен знімків з з помірним рослинним покривом. Підсумкове значення SAVI варіюється від -1.5 до +1.5 (якщо L = 0.5). Додатково можна більше почитати про Індексі рослинності з корекцією по грунту .

...

Нижче наведено кроки та параметри, які ми використовуємо для розрахунку індексу у ПО ArcGIS Pro.

![alt text](https://miro.medium.com/max/756/0*le6Yjp3fxxi93uMH.png?raw=true)
![alt text](https://miro.medium.com/max/594/0*cGEf4JS9qJjMPdCD.png?raw=true)
Для порівняння індексів формуємо два одноканальних знимки з супутникових даних Planet.
![alt text](https://miro.medium.com/max/368/0*aaUGmuXzRXs1Glt4.png?raw=true)

Найвищі значення SAVI, позначені білим або світло-сірим тонами, представляють області з підвищеним наявністю здорової рослинності. Багато полів, мають більш високі значення SAVI до шторму ніж після нього. Однак все ще складно побачити, чи вплинув шторм на деякі поля більше, ніж на інші. Потрібно обчислити різницю між двома шарами SAVI, щоб виміряти зміну рослинності більш точно.

до
![alt text](https://miro.medium.com/max/1262/1*6mo5Aj5FhKB5sXI0CVYuNw.jpeg?raw=true)

після
![alt text](https://miro.medium.com/max/1248/1*n1rNzfu3xBtsE4oSNqH32g.jpeg?raw=true)

## Обчислення змін між двома шарами SAVI
Щоб виміряти зміни в рослинності, що відбулися через шторм можна скористатися функціоналом ArcGIS Pro. Отримане значення означатиме втрату здорової рослинності.

![alt text](https://miro.medium.com/max/714/0*uF5jHJhwJJD4LY4l.png?raw=true)
![alt text](https://miro.medium.com/max/684/0*C7DCg1JBXoSXLfCk.png?raw=true)
![alt text](https://miro.medium.com/max/672/0*ZEwnQoerAbs1VCa0.png?raw=true)

![alt text](https://miro.medium.com/max/1100/0*uZfV6dwpUu1qpWGY.png?raw=true)

Області в пурпурних тонах вказують на втрату здорової рослинності (позитивні числові значення), найістотніша втрата позначена темно-пурпуровим кольором. Візуальне вивчення вказує досить ясно, що град перетнув область по діагоналі з північного заходу на південний схід, пошкоджуючи більшість полів в цьому напрямку. Поля у верхньому правому кутку і нижньому лівому кутку зображення виглядають набагато менш пошкодженими.
Можна помітити, що кілька областей, позначених зеленим кольором (негативні числові значення), по-видимому, вказують на невелике збільшення рослинності. Оскільки ці два зображення поділяють всього чотири дні, малоймовірно, що за цей час відбулося значне зростання сільськогосподарської рослинності. Однак цілком можливо, що на деяких ділянках голої землі, які були сухими через серпневу погоди, швидко почали зростати бур’яни після того, як вони намокли від дощу і розтанув граду під час шторму.
Невелике збільшення рослинності не має відношення до аналізу пошкодження врожаю, тому прибираємо всі значення нижче 0 в растрі.

![alt text](https://miro.medium.com/max/684/0*xXdj8920pyAL7pZZ.png?raw=true)
![alt text](https://miro.medium.com/max/834/0*4QJcMgQXpaZplzr1.png?raw=true)
![alt text](https://miro.medium.com/max/1100/0*mcAqCXl4zFkWV2hq.png?raw=true)

Новий растровий шар показує тільки області, де є втрати здорової рослинності. Більш глибокий пурпурний колір вказує сильніші втрати в здорової рослинності.

## Витяг середнього значення втрат рослинності для кожного поля

Залишається тільки значення до існуючих полів

![alt text](https://miro.medium.com/max/1100/0*YN-MABMRyZAsTaYg.png?raw=true)
![alt text](https://miro.medium.com/max/680/0*PHWfFbzDC0rXLn6w.png?raw=true)

![alt text](https://miro.medium.com/max/832/0*iImEFf_at_VV2Q6u.png?raw=true)

Фінальний результат.

![alt text](https://miro.medium.com/max/1100/0*LmdnM8fYFtApIp-W.png?raw=true)

Поля з високими та дуже високими втратами здорової рослинності, явно зосереджені на тій же осі з північного заходу на південний схід. Поля з низькими втратами в основному сконцентровані в верхньому правому і нижньому лівому кутах.
Можна помітити деякі сусідні поля з різними рівнями ушкоджень. Причин для цього може бути безліч. Наприклад, на різні культури град міг вплинути по-різному. Також, на два поля з однаковими культурами, але різними рівнями зрілості рослин, град теж міг вплинути по-різному.
Карта пропонує первинну оцінку збитку від граду. Вона могла б використовуватися як керівництво для більш детальних інспекцій на місці.